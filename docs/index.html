<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MAiDAS</title>
    <style>
      :root {
        --bg: #0b0c10;
        --panel: #11131a;
        --text: #e6e9ef;
        --muted: #a9b1c0;
        --link: #7aa2f7;
        --border: #1f2330;
        --code: #0f1624;
      }
      html, body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        line-height: 1.6;
      }
      .wrap {
        max-width: 920px;
        margin: 0 auto;
        padding: 40px 20px 80px;
      }
      header {
        margin-bottom: 24px;
      }
      header h1 {
        margin: 0 0 6px;
        font-size: 28px;
      }
      header p {
        margin: 0;
        color: var(--muted);
      }
      main {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 28px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      }
      h1, h2, h3 {
        line-height: 1.25;
        margin: 28px 0 12px;
      }
      h1 { font-size: 28px; }
      h2 { font-size: 22px; }
      h3 { font-size: 18px; }
      p { margin: 12px 0; }
      ul { padding-left: 22px; margin: 10px 0; }
      li { margin: 6px 0; }
      a { color: var(--link); text-decoration: none; }
      a:hover { text-decoration: underline; }
      blockquote {
        margin: 16px 0;
        padding: 10px 14px;
        border-left: 3px solid var(--link);
        background: rgba(122, 162, 247, 0.08);
        color: var(--muted);
        border-radius: 8px;
      }
      pre {
        margin: 16px 0;
        padding: 14px;
        border-radius: 10px;
        background: var(--code);
        border: 1px solid var(--border);
        overflow: auto;
      }
      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.95em;
        background: var(--code);
        padding: 2px 6px;
        border-radius: 6px;
        border: 1px solid var(--border);
      }
      pre code {
        background: transparent;
        border: 0;
        padding: 0;
      }
      .meta {
        margin-top: 16px;
        color: var(--muted);
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>MAiDAS</h1>
        <p>사람에게는 읽기 좋게, 에이전트에게는 구조적으로.</p>
      </header>
      <main id="app" aria-busy="true">로딩 중...</main>
      <div class="meta">Source: <code>docs/index.md</code></div>
    </div>

    <script>
      const escapeHtml = (s) =>
        s.replaceAll("&", "&amp;")
         .replaceAll("<", "&lt;")
         .replaceAll(">", "&gt;")
         .replaceAll('"', "&quot;")
         .replaceAll("'", "&#39;");

      function renderInline(text) {
        const escaped = escapeHtml(text);
        const codeSpans = [];
        const withCodes = escaped.replace(/`([^`]+)`/g, (_, code) => {
          const token = `__CODE_${codeSpans.length}__`;
          codeSpans.push(`<code>${code}</code>`);
          return token;
        });
        const withLinks = withCodes.replace(/\[([^\]]+)\]\(([^)]+)\)/g, (_, label, href) => {
          const safeHref = href.startsWith("http") ? href : href;
          return `<a href="${safeHref}">${label}</a>`;
        });
        return withLinks.replace(/__CODE_(\d+)__/g, (_, i) => codeSpans[Number(i)]);
      }

      function markdownToHtml(md) {
        const lines = md.replace(/\r\n?/g, "\n").split("\n");
        const out = [];
        let inFence = false;
        let fenceLang = "";
        let fenceBuf = [];
        let inList = false;
        let inQuote = false;

        const closeList = () => {
          if (inList) {
            out.push("</ul>");
            inList = false;
          }
        };
        const closeQuote = () => {
          if (inQuote) {
            out.push("</blockquote>");
            inQuote = false;
          }
        };

        for (let i = 0; i < lines.length; i += 1) {
          const raw = lines[i];
          const line = raw.trimEnd();

          if (line.startsWith("---") && out.length === 0) {
            while (i + 1 < lines.length && !lines[i + 1].startsWith("---")) i += 1;
            if (i + 1 < lines.length) i += 1;
            continue;
          }

          if (line.startsWith("```")) {
            if (!inFence) {
              inFence = true;
              fenceLang = line.slice(3).trim();
              fenceBuf = [];
              closeList();
              closeQuote();
            } else {
              const code = escapeHtml(fenceBuf.join("\n"));
              const cls = fenceLang ? ` class="language-${fenceLang}"` : "";
              out.push(`<pre><code${cls}>${code}</code></pre>`);
              inFence = false;
              fenceLang = "";
              fenceBuf = [];
            }
            continue;
          }

          if (inFence) {
            fenceBuf.push(raw);
            continue;
          }

          if (!line) {
            closeList();
            closeQuote();
            continue;
          }

          if (line.startsWith("> ")) {
            closeList();
            if (!inQuote) {
              out.push("<blockquote>");
              inQuote = true;
            }
            out.push(`<p>${renderInline(line.slice(2))}</p>`);
            continue;
          }

          const h = /^(#{1,3})\s+(.*)$/.exec(line);
          if (h) {
            closeList();
            closeQuote();
            const level = h[1].length;
            out.push(`<h${level}>${renderInline(h[2])}</h${level}>`);
            continue;
          }

          const li = /^-\s+(.*)$/.exec(line);
          if (li) {
            closeQuote();
            if (!inList) {
              out.push("<ul>");
              inList = true;
            }
            out.push(`<li>${renderInline(li[1])}</li>`);
            continue;
          }

          closeList();
          closeQuote();
          out.push(`<p>${renderInline(line)}</p>`);
        }

        closeList();
        closeQuote();
        return out.join("\n");
      }

      async function main() {
        const app = document.getElementById("app");
        try {
          const res = await fetch("./index.md", { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const md = await res.text();
          app.innerHTML = markdownToHtml(md);
        } catch (err) {
          app.innerHTML = `\n            <h2>불러오기 실패</h2>\n            <p><code>docs/index.md</code>를 읽지 못했습니다.</p>\n            <p>${escapeHtml(String(err))}</p>\n          `;
        } finally {
          app.setAttribute("aria-busy", "false");
        }
      }

      main();
    </script>
  </body>
</html>
